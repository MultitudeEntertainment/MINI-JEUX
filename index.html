<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Quiz des Capitales</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet (Carte du monde) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
    body {
        margin: 0;
        background: #0d1117;
        color: white;
        font-family: Arial, sans-serif;
        height: 100vh;
        overflow: hidden;
    }

    #app {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    /* √âcrans */
    .screen {
        display: none;
        width: 100%;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
    }

    .active {
        display: block;
    }

    /* Accueil */
    #home {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        gap: 20px;
    }

    .btn {
        padding: 15px 25px;
        border: none;
        border-radius: 10px;
        font-size: 1.2rem;
        cursor: pointer;
        width: 250px;
        color: white;
    }

    .easy { background: #22c55e; }
    .medium { background: #f59e0b; }
    .hard { background: #ef4444; }

    /* Quiz */
    #quiz {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    #map {
        height: 40vh;
        width: 100%;
        border-radius: 10px;
        overflow: hidden;
    }

    #question-box {
        background: #161b22;
        padding: 15px;
        border-radius: 10px;
    }

    .answer {
        background: #21262d;
        padding: 12px;
        border-radius: 8px;
        margin-top: 10px;
        cursor: pointer;
        border: 1px solid #30363d;
    }

    .correct { background: #14532d !important; border-color: #22c55e !important; }
    .wrong { background: #4c1d1d !important; border-color: #ef4444 !important; }

    #next {
        margin-top: 15px;
        padding: 12px;
        background: #3b82f6;
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 1rem;
        cursor: pointer;
        display: none;
    }

    /* R√©sultat */
    #result {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 20px;
        text-align: center;
    }

    #restart {
        background: #3b82f6;
    }
</style>
</head>
<body>

<div id="app">

    <!-- ACCUEIL -->
    <div id="home" class="screen active">
        <h1>üåç Quiz des Capitales</h1>
        <p>Choisissez une difficult√©</p>

        <button class="btn easy" onclick="startGame('easy')">Facile</button>
        <button class="btn medium" onclick="startGame('medium')">Moyen</button>
        <button class="btn hard" onclick="startGame('hard')">Difficile</button>
    </div>

    <!-- QUIZ -->
    <div id="quiz" class="screen">
        <div id="map"></div>

        <div id="question-box">
            <h2 id="country-name"></h2>
            <p>Quelle est la capitale ?</p>

            <div id="answers"></div>

            <button id="next" onclick="nextQuestion()">Question suivante</button>
        </div>
    </div>

    <!-- RESULTAT -->
    <div id="result" class="screen">
        <h1 id="score"></h1>
        <p>Vous pouvez montrer votre score aux autres membres du serveur</p>
        <button id="restart" class="btn" onclick="goHome()">Retour √† l'accueil</button>
    </div>

</div>

<script>
/* ---------------------------
   BASE DE DONN√âES PAYS
   Avec coordonn√©es GPS
----------------------------*/
const COUNTRIES = [
    { name: "France", capital: "Paris", lat: 48.8566, lon: 2.3522, difficulty: "easy" },
    { name: "Espagne", capital: "Madrid", lat: 40.4168, lon: -3.7038, difficulty: "easy" },
    { name: "Italie", capital: "Rome", lat: 41.9028, lon: 12.4964, difficulty: "easy" },
    { name: "√âtats-Unis", capital: "Washington", lat: 38.9072, lon: -77.0369, difficulty: "easy" },
    { name: "Canada", capital: "Ottawa", lat: 45.4215, lon: -75.6972, difficulty: "easy" },
    { name: "Japon", capital: "Tokyo", lat: 35.6762, lon: 139.6503, difficulty: "easy" },

    /* Moyen */
    { name: "Portugal", capital: "Lisbonne", lat: 38.7223, lon: -9.1393, difficulty: "medium" },
    { name: "Belgique", capital: "Bruxelles", lat: 50.8503, lon: 4.3517, difficulty: "medium" },
    { name: "Turquie", capital: "Ankara", lat: 39.9334, lon: 32.8597, difficulty: "medium" },
    { name: "√âgypte", capital: "Le Caire", lat: 30.0444, lon: 31.2357, difficulty: "medium" },

    /* Difficile */
    { name: "Mongolie", capital: "Oulan-Bator", lat: 47.8864, lon: 106.9057, difficulty: "hard" },
    { name: "Bhoutan", capital: "Thimphou", lat: 27.4728, lon: 89.6390, difficulty: "hard" },
    { name: "N√©pal", capital: "Katmandou", lat: 27.7172, lon: 85.3240, difficulty: "hard" },
    { name: "Tanzanie", capital: "Dodoma", lat: -6.1630, lon: 35.7516, difficulty: "hard" }
];

/* ---------------------------
   VARIABLES DU JEU
----------------------------*/
let map;
let marker;
let difficulty;
let questions = [];
let index = 0;
let score = 0;

/* ---------------------------
   INITIALISATION CARTE
----------------------------*/
function initMap() {
    map = L.map('map').setView([20, 0], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 6
    }).addTo(map);
}

/* ---------------------------
   D√âMARRER LE JEU
----------------------------*/
function startGame(diff) {
    difficulty = diff;
    score = 0;
    index = 0;

    questions = COUNTRIES.filter(c => {
        if (diff === "easy") return c.difficulty === "easy";
        if (diff === "medium") return c.difficulty !== "hard";
        return true;
    });

    questions = questions.sort(() => Math.random() - 0.5).slice(0, 20);

    document.getElementById("home").classList.remove("active");
    document.getElementById("quiz").classList.add("active");

    if (!map) initMap();

    loadQuestion();
}

/* ---------------------------
   CHARGER UNE QUESTION
----------------------------*/
function loadQuestion() {
    const q = questions[index];

    document.getElementById("country-name").textContent = q.name;

    // Zoom sur le pays
    map.setView([q.lat, q.lon], 4);

    if (marker) marker.remove();
    marker = L.marker([q.lat, q.lon]).addTo(map);

    // G√©n√©rer r√©ponses
    const answersDiv = document.getElementById("answers");
    answersDiv.innerHTML = "";

    const wrong = COUNTRIES.filter(c => c.name !== q.name)
                           .sort(() => Math.random() - 0.5)
                           .slice(0, 2);

    const options = [
        { text: q.capital, correct: true },
        { text: wrong[0].capital, correct: false },
        { text: wrong[1].capital, correct: false }
    ].sort(() => Math.random() - 0.5);

    options.forEach(opt => {
        const div = document.createElement("div");
        div.className = "answer";
        div.textContent = opt.text;
        div.onclick = () => selectAnswer(div, opt.correct);
        answersDiv.appendChild(div);
    });

    document.getElementById("next").style.display = "none";
}

/* ---------------------------
   R√âPONSE
----------------------------*/
function selectAnswer(div, correct) {
    if (correct) {
        div.classList.add("correct");
        score++;
    } else {
        div.classList.add("wrong");
    }

    document.querySelectorAll(".answer").forEach(a => a.onclick = null);
    document.getElementById("next").style.display = "block";
}

/* ---------------------------
   QUESTION SUIVANTE
----------------------------*/
function nextQuestion() {
    index++;
    if (index >= 20) return endGame();
    loadQuestion();
}

/* ---------------------------
   FIN DU JEU
----------------------------*/
function endGame() {
    document.getElementById("quiz").classList.remove("active");
    document.getElementById("result").classList.add("active");

    document.getElementById("score").textContent =
        `Score : ${score} / 20`;
}

/* ---------------------------
   RETOUR ACCUEIL
----------------------------*/
function goHome() {
    document.getElementById("result").classList.remove("active");
    document.getElementById("home").classList.add("active");
}
</script>

</body>
</html>
